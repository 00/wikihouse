<%inherit file="base.tmpl"/>

<%def name="sub_title()">${target is None and _(u'Browse Library') or target.title}</%def>

<%def name="design_listing(item, show_series=False)">
  <li>
  <div class="row">
    <div class="design-panel">
      % if item.model_preview:
        <div class="thumbnail left">
          <img src="/blob/${item.model_preview.key()}" />
        </div>
      % endif
      <div class="design-details left padding-left">
        <div class="title">
          <!--${item.key().id()}-->
          <a href="/library/design/${item.key().id()}">
            <h4>${escape(item.title)}</h4></a>
        </div>
        <div class="user padding-top">
          by: 
          <a href="/library/user/${item.user.user_id()}">
            ${escape(item.user.nickname())}</a>
        </div>
      </div>
      % if show_series:
        <div class="series left">
          Series: 
          <%
            i = 0
            l = len(item.series)
          %>
          % for s in item.series:
            <% i = i + 1 %>
            <a href="/library/series/${s.name()}">
              ${s.name().upper()}</a>${i < l and ', ' or ''}
          % endfor
        </div>
      % endif
    </div>
  <div>
  </li>
</%def>

<%def name="main_content()">
  <h4>${_(u'Designs')}</h4>
  <ul class="designs">
    <% 
      show_series = target is None
    %>
    % for item in designs:
      ${self.design_listing(item, show_series=show_series)}
    % endfor
  </ul>
</%def>

<%def name="actions()">
  <h4>Series</h4>
  <div class="panel">
        <div class="padding-sides-small ${target and 'hide' or 'show'}">
          <div class="description padding-top-bottom">
            Select a Series...
          </div>
          <div class="more-info-link padding-bottom">
            <a href="/about#series" class="link small strong">More information...</a>
          </div>
        </div>
    % if target:
      % for item in series:   
        % if target.key() == item.key():
          <div class="padding-sides-small selected">
            <div class="description padding-top-bottom">
            ${item.title}
            ${item.description}
            </div>
            <div class="more-info-link padding-bottom">
              <a href="/about#series" class="link small strong">More information...</a>
            </div>
          </div>
        % endif
      % endfor
    % endif
  </div>
  <ul class="series-nav">
    <!--
      
      It may be we need to duplicate the series blocks here and show hide
      a seperate block when the layout is less than 768 / whatever triggers
      an inline block menu.
      
      For now, we're show/hiding a panel within the navigation `<li />`sm which
      is fine for a vertical accordion style menu.
      
      
    -->
    % for item in series:
      <li class="series-selectors left ${target and target.key() == item.key() and 'selected-series' or ''}">
        <div class="bar">
          <a href="/library/series/${item.key().name()}">
          % if target:
            % if target.key() == item.key():
                <img class="series-button-sel" width="68px" height="68px" src="${get_static_url('gfx/series/%s.tr.png' % item.key().name())}" />
            % else:
                <img class="series-button" width="68px" height="68px" src="${get_static_url('gfx/series/%s.tr.png' % item.key().name())}" />
            % endif
          % else:
              <img class="series-button" width="68px" height="68px" src="${get_static_url('gfx/series/%s.tr.png' % item.key().name())}" />
          % endif
          </a>
        </div>
      </li>
    % endfor
  </ul>
  <div class="series-block">
    % if target:
      % for item in series:
        % if target.key() == item.key():
          <div class="panel">
            <div class="series-title">
              <a href="/library/series/${item.key().name()}">
                ${item.title}</a>
            </div>
            <div class="series-image">
              <img src="${get_static_url('gfx/series/%s.png' % item.key().name())}" />
            </div>
            <div class="description">
              ${item.description}
            </div>
            <div class="more-info-link">
              <a href="/about#series">${_(u'More information')}</a>
            </div>
          </div>
        % endif
      % endfor
    % endif
  </div>
</%def>

<%def name="content()">
  <div class="series-small">
    <div class="series padding-top">
    ${self.actions()}
    </div>
  </div>
  <div class="slot-6-7-8 series-small padding-top-bottom">
    <div class="padding-left padding-top">
    ${self.main_content()}
    </div>
  </div>
  <div class="slot-6-7-8 series-big padding-top-bottom">
    <div class="padding-left padding-top">
    ${self.main_content()}
    </div>
  </div>
  <div class="slot-9 series-big padding-top-bottom">
    <div class="series padding-top">
    ${self.actions()}
    </div>
  </div>
</%def>
